-- Add season column and 2026 AFL fixture data
-- Generated by generate_2026_fixture.py

-- Allow NULL match_date for floating fixture rounds (dates TBA)
ALTER TABLE matches ALTER COLUMN match_date DROP NOT NULL;

-- Add season column to matches table
ALTER TABLE matches ADD COLUMN IF NOT EXISTS season INTEGER DEFAULT 2025;

-- Update existing matches to season 2025
UPDATE matches SET season = 2025 WHERE season IS NULL;

-- Create index on season column
CREATE INDEX IF NOT EXISTS idx_matches_season ON matches(season);

-- Create temp table for 2026 fixture data
CREATE TEMP TABLE tmp_2026_fixture (
  round INTEGER,
  home_abbr TEXT,
  away_abbr TEXT,
  venue TEXT,
  match_date TIMESTAMPTZ
);

-- Insert 2026 fixture data
INSERT INTO tmp_2026_fixture (round, home_abbr, away_abbr, venue, match_date) VALUES
  (0, 'SYD', 'CAR', 'SCG', '2026-03-05 08:30:00+00'),
  (0, 'GC', 'GEE', 'PFS', '2026-03-06 08:30:00+00'),
  (0, 'GWS', 'HAW', 'ES', '2026-03-07 05:35:00+00'),
  (0, 'BRL', 'WB', 'G', '2026-03-07 08:25:00+00'),
  (0, 'STK', 'COL', 'MCG', '2026-03-08 08:20:00+00'),
  (1, 'CAR', 'RIC', 'MCG', '2026-03-12 08:30:00+00'),
  (1, 'ESS', 'HAW', 'MCG', '2026-03-13 08:30:00+00'),
  (1, 'WB', 'GWS', 'MRVL', '2026-03-14 02:45:00+00'),
  (1, 'GEE', 'FRE', 'GMHBA', '2026-03-14 05:35:00+00'),
  (1, 'SYD', 'BRL', 'SCG', '2026-03-14 08:25:00+00'),
  (1, 'COL', 'ADL', 'MCG', '2026-03-14 08:35:00+00'),
  (1, 'NM', 'PA', 'MRVL', '2026-03-15 02:10:00+00'),
  (1, 'MEL', 'STK', 'MCG', '2026-03-15 04:20:00+00'),
  (1, 'GC', 'WC', 'PFS', '2026-03-15 08:20:00+00'),
  (2, 'HAW', 'SYD', 'MCG', '2026-03-19 08:30:00+00'),
  (2, 'ADL', 'WB', 'AO', '2026-03-20 08:30:00+00'),
  (2, 'RIC', 'GC', 'MCG', '2026-03-21 02:45:00+00'),
  (2, 'GWS', 'STK', 'ES', '2026-03-21 05:35:00+00'),
  (2, 'FRE', 'MEL', 'OS', '2026-03-21 08:25:00+00'),
  (2, 'PA', 'ESS', 'AO', '2026-03-22 02:10:00+00'),
  (2, 'WC', 'NM', 'OS', '2026-03-22 08:20:00+00'),
  (3, 'GEE', 'ADL', 'GMHBA', '2026-03-26 08:30:00+00'),
  (3, 'COL', 'GWS', 'MRVL', '2026-03-27 08:30:00+00'),
  (3, 'STK', 'BRL', 'MRVL', '2026-03-28 02:45:00+00'),
  (3, 'FRE', 'RIC', 'OS', '2026-03-28 05:35:00+00'),
  (3, 'ESS', 'NM', 'MRVL', '2026-03-28 08:25:00+00'),
  (3, 'PA', 'WC', 'AO', '2026-03-29 02:10:00+00'),
  (3, 'CAR', 'MEL', 'MCG', '2026-03-29 04:20:00+00'),
  (4, 'BRL', 'COL', 'G', '2026-04-02 08:30:00+00'),
  (4, 'NM', 'CAR', 'MRVL', '2026-04-03 04:15:00+00'),
  (4, 'ADL', 'FRE', 'AO', '2026-04-03 08:30:00+00'),
  (4, 'RIC', 'PA', 'MCG', '2026-04-04 05:35:00+00'),
  (4, 'WC', 'SYD', 'OS', '2026-04-04 08:25:00+00'),
  (4, 'MEL', 'GC', 'MCG', '2026-04-05 03:10:00+00'),
  (4, 'WB', 'ESS', 'MRVL', '2026-04-05 09:20:00+00'),
  (4, 'HAW', 'GEE', 'MCG', '2026-04-06 05:20:00+00'),
  (5, 'ADL', 'CAR', 'AO', '2026-04-09 09:40:00+00'),
  (5, 'COL', 'FRE', 'AO', '2026-04-10 09:40:00+00'),
  (5, 'NM', 'BRL', 'BP', '2026-04-11 02:35:00+00'),
  (5, 'ESS', 'MEL', 'AO', '2026-04-11 03:15:00+00'),
  (5, 'SYD', 'GC', 'NO', '2026-04-11 06:15:00+00'),
  (5, 'HAW', 'WB', 'AO', '2026-04-11 09:35:00+00'),
  (5, 'GEE', 'WC', 'NO', '2026-04-12 02:30:00+00'),
  (5, 'GWS', 'RIC', 'BP', '2026-04-12 05:15:00+00'),
  (5, 'PA', 'STK', 'AO', '2026-04-12 09:15:00+00'),
  (6, 'CAR', 'COL', 'MCG', '2026-04-16 09:30:00+00'),
  (6, 'GEE', 'WB', 'GMHBA', '2026-04-17 09:30:00+00'),
  (6, 'SYD', 'GWS', 'SCG', '2026-04-17 09:50:00+00'),
  (6, 'GC', 'ESS', 'PFS', '2026-04-18 03:45:00+00'),
  (6, 'HAW', 'PA', 'MRVL', '2026-04-18 06:35:00+00'),
  (6, 'ADL', 'STK', 'AO', '2026-04-18 09:25:00+00'),
  (6, 'NM', 'RIC', 'MRVL', '2026-04-19 03:10:00+00'),
  (6, 'MEL', 'BRL', 'MCG', '2026-04-19 05:20:00+00'),
  (6, 'WC', 'FRE', 'OS', '2026-04-19 06:40:00+00'),
  (7, 'WB', 'SYD', 'MRVL', '2026-04-23 09:30:00+00'),
  (7, 'RIC', 'MEL', 'MCG', '2026-04-24 09:30:00+00'),
  (7, 'HAW', 'GC', 'UTAS', '2026-04-25 03:45:00+00'),
  (7, 'ESS', 'COL', 'MCG', '2026-04-25 05:20:00+00'),
  (7, 'PA', 'GEE', 'AO', '2026-04-25 09:25:00+00'),
  (7, 'FRE', 'CAR', 'OS', '2026-04-25 09:35:00+00'),
  (7, 'STK', 'WC', 'MRVL', '2026-04-26 03:10:00+00'),
  (7, 'BRL', 'ADL', 'G', '2026-04-26 05:20:00+00'),
  (7, 'GWS', 'NM', 'CGOM', '2026-04-26 06:40:00+00'),
  (8, 'COL', 'HAW', 'MCG', '2026-04-30 09:30:00+00'),
  (8, 'WB', 'FRE', 'MRVL', '2026-05-01 09:30:00+00'),
  (8, 'ADL', 'PA', 'AO', '2026-05-01 09:50:00+00'),
  (8, 'ESS', 'BRL', 'MRVL', '2026-05-02 03:45:00+00'),
  (8, 'WC', 'RIC', 'OS', '2026-05-02 06:35:00+00'),
  (8, 'GEE', 'NM', 'GMHBA', '2026-05-02 06:45:00+00'),
  (8, 'CAR', 'STK', 'MRVL', '2026-05-02 09:25:00+00'),
  (8, 'SYD', 'MEL', 'SCG', '2026-05-03 03:10:00+00'),
  (8, 'GC', 'GWS', 'PFS', '2026-05-03 09:20:00+00'),
  (9, 'FRE', 'HAW', 'OS', '2026-05-07 09:30:00+00'),
  (9, 'BRL', 'CAR', 'G', '2026-05-08 09:30:00+00'),
  (9, 'PA', 'WB', 'AO', '2026-05-08 09:50:00+00'),
  (9, 'NM', 'SYD', 'MRVL', '2026-05-09 03:45:00+00'),
  (9, 'GWS', 'ESS', 'ES', '2026-05-09 06:35:00+00'),
  (9, 'GC', 'STK', 'TIO', '2026-05-09 09:25:00+00'),
  (9, 'GEE', 'COL', 'MCG', '2026-05-09 09:35:00+00'),
  (9, 'MEL', 'WC', 'MRVL', '2026-05-10 03:10:00+00'),
  (9, 'RIC', 'ADL', 'MCG', '2026-05-10 05:20:00+00'),
  (10, 'BRL', 'GEE', 'G', '2026-05-14 09:30:00+00'),
  (10, 'SYD', 'COL', 'SCG', '2026-05-15 09:30:00+00'),
  (10, 'GC', 'PA', 'TIO', '2026-05-15 09:50:00+00'),
  (10, 'ADL', 'NM', 'AO', '2026-05-16 03:45:00+00'),
  (10, 'MEL', 'HAW', 'MCG', '2026-05-16 06:35:00+00'),
  (10, 'CAR', 'WB', 'MRVL', '2026-05-16 09:25:00+00'),
  (10, 'ESS', 'FRE', 'MCG', '2026-05-17 03:10:00+00'),
  (10, 'STK', 'RIC', 'MRVL', '2026-05-17 05:20:00+00'),
  (10, 'WC', 'GWS', 'OS', '2026-05-17 09:20:00+00'),
  (11, 'HAW', 'ADL', 'UTAS', '2026-05-21 09:30:00+00'),
  (11, 'RIC', 'ESS', 'MCG', '2026-05-22 09:30:00+00'),
  (11, 'FRE', 'STK', 'OS', '2026-05-22 09:50:00+00'),
  (11, 'NM', 'GC', 'MRVL', '2026-05-23 03:45:00+00'),
  (11, 'GEE', 'SYD', 'GMHBA', '2026-05-23 06:35:00+00'),
  (11, 'COL', 'WC', 'MCG', '2026-05-23 06:45:00+00'),
  (11, 'PA', 'CAR', 'AO', '2026-05-23 09:25:00+00'),
  (11, 'GWS', 'BRL', 'ES', '2026-05-24 03:10:00+00'),
  (11, 'WB', 'MEL', 'MRVL', '2026-05-24 05:20:00+00'),
  (12, 'STK', 'HAW', 'MRVL', '2026-05-28 09:30:00+00'),
  (12, 'CAR', 'GEE', 'MCG', '2026-05-29 09:30:00+00'),
  (12, 'SYD', 'RIC', 'SCG', '2026-05-30 03:45:00+00'),
  (12, 'BRL', 'FRE', 'G', '2026-05-30 06:35:00+00'),
  (12, 'WB', 'COL', 'MRVL', '2026-05-30 09:25:00+00'),
  (12, 'MEL', 'GWS', 'TP', '2026-05-31 03:10:00+00'),
  (12, 'WC', 'ESS', 'OS', '2026-05-31 09:20:00+00'),
  (13, 'ADL', 'GEE', 'AO', '2026-06-04 09:30:00+00'),
  (13, 'HAW', 'WB', 'MCG', '2026-06-05 09:30:00+00'),
  (13, 'NM', 'FRE', 'HO', '2026-06-06 03:45:00+00'),
  (13, 'GC', 'BRL', 'PFS', '2026-06-06 06:35:00+00'),
  (13, 'WC', 'PA', 'OS', '2026-06-06 09:25:00+00'),
  (13, 'SYD', 'STK', 'SCG', '2026-06-07 03:10:00+00'),
  (13, 'ESS', 'CAR', 'MCG', '2026-06-07 09:20:00+00'),
  (13, 'COL', 'MEL', 'MCG', '2026-06-08 05:20:00+00'),
  (14, 'WB', 'ADL', 'MRVL', '2026-06-11 09:30:00+00'),
  (14, 'GEE', 'GC', 'GMHBA', '2026-06-12 09:30:00+00'),
  (14, 'MEL', 'ESS', 'MCG', '2026-06-13 03:45:00+00'),
  (14, 'NM', 'WC', 'OS', '2026-06-13 06:35:00+00'),
  (14, 'PA', 'SYD', 'AO', '2026-06-13 09:25:00+00'),
  (14, 'RIC', 'BRL', 'NS', '2026-06-14 03:10:00+00'),
  (14, 'STK', 'GWS', 'MRVL', '2026-06-14 09:20:00+00'),
  (15, 'FRE', 'GEE', 'OS', '2026-06-18 09:30:00+00'),
  (15, 'GC', 'HAW', 'PFS', '2026-06-19 09:30:00+00'),
  (15, 'ADL', 'MEL', 'AO', '2026-06-20 03:45:00+00'),
  (15, 'GWS', 'CAR', 'ES', '2026-06-20 06:35:00+00'),
  (15, 'COL', 'PA', 'MCG', '2026-06-20 09:25:00+00'),
  (15, 'RIC', 'NM', 'MCG', '2026-06-21 03:10:00+00'),
  (15, 'STK', 'WB', 'MRVL', '2026-06-21 05:20:00+00'),
  (16, 'BRL', 'SYD', 'G', NULL),
  (16, 'CAR', 'WC', 'MRVL', NULL),
  (16, 'COL', 'RIC', 'MCG', NULL),
  (16, 'FRE', 'GC', 'OS', NULL),
  (16, 'HAW', 'GWS', 'MCG', NULL),
  (16, 'NM', 'ESS', 'MRVL', NULL),
  (16, 'PA', 'ADL', 'AO', NULL),
  (17, 'ESS', 'STK', 'MRVL', NULL),
  (17, 'GEE', 'BRL', 'GMHBA', NULL),
  (17, 'GC', 'COL', 'PFS', NULL),
  (17, 'GWS', 'FRE', 'CGOM', NULL),
  (17, 'HAW', 'MEL', 'UTAS', NULL),
  (17, 'PA', 'NM', 'AO', NULL),
  (17, 'RIC', 'CAR', 'MCG', NULL),
  (17, 'SYD', 'WB', 'SCG', NULL),
  (17, 'WC', 'ADL', 'OS', NULL),
  (18, 'ADL', 'GC', 'AO', NULL),
  (18, 'BRL', 'ESS', 'G', NULL),
  (18, 'CAR', 'HAW', 'MCG', NULL),
  (18, 'COL', 'NM', 'MRVL', NULL),
  (18, 'FRE', 'SYD', 'OS', NULL),
  (18, 'GWS', 'GEE', 'ES', NULL),
  (18, 'MEL', 'RIC', 'MCG', NULL),
  (18, 'STK', 'PA', 'MRVL', NULL),
  (18, 'WB', 'WC', 'MRVL', NULL),
  (19, 'COL', 'CAR', 'MCG', NULL),
  (19, 'ESS', 'GWS', 'MRVL', NULL),
  (19, 'GEE', 'STK', 'GMHBA', NULL),
  (19, 'GC', 'WB', 'PFS', NULL),
  (19, 'NM', 'MEL', 'MRVL', NULL),
  (19, 'PA', 'FRE', 'AO', NULL),
  (19, 'RIC', 'HAW', 'MCG', NULL),
  (19, 'SYD', 'ADL', 'SCG', NULL),
  (19, 'WC', 'BRL', 'OS', NULL),
  (20, 'ADL', 'COL', 'AO', NULL),
  (20, 'BRL', 'PA', 'G', NULL),
  (20, 'CAR', 'GC', 'MRVL', NULL),
  (20, 'FRE', 'WC', 'OS', NULL),
  (20, 'GWS', 'SYD', 'ES', NULL),
  (20, 'HAW', 'ESS', 'MCG', NULL),
  (20, 'NM', 'STK', 'MRVL', NULL),
  (20, 'MEL', 'GEE', 'MCG', NULL),
  (20, 'WB', 'RIC', 'MRVL', NULL),
  (21, 'CAR', 'BRL', 'MRVL', NULL),
  (21, 'COL', 'GEE', 'MCG', NULL),
  (21, 'ESS', 'ADL', 'MRVL', NULL),
  (21, 'FRE', 'WB', 'OS', NULL),
  (21, 'GC', 'MEL', 'PFS', NULL),
  (21, 'HAW', 'NM', 'UTAS', NULL),
  (21, 'PA', 'GWS', 'AO', NULL),
  (21, 'RIC', 'WC', 'MCG', NULL),
  (21, 'STK', 'SYD', 'MRVL', NULL),
  (22, 'ADL', 'RIC', 'AO', NULL),
  (22, 'BRL', 'HAW', 'G', NULL),
  (22, 'GEE', 'ESS', 'GMHBA', NULL),
  (22, 'GWS', 'GC', 'CGOM', NULL),
  (22, 'MEL', 'FRE', 'MCG', NULL),
  (22, 'STK', 'CAR', 'MRVL', NULL),
  (22, 'SYD', 'PA', 'SCG', NULL),
  (22, 'WC', 'COL', 'OS', NULL),
  (22, 'WB', 'NM', 'MRVL', NULL),
  (23, 'BRL', 'GC', 'G', NULL),
  (23, 'ESS', 'SYD', 'MCG', NULL),
  (23, 'FRE', 'ADL', 'OS', NULL),
  (23, 'GWS', 'WC', 'ES', NULL),
  (23, 'HAW', 'COL', 'MCG', NULL),
  (23, 'NM', 'GEE', 'MRVL', NULL),
  (23, 'PA', 'MEL', 'AO', NULL),
  (23, 'RIC', 'STK', 'MCG', NULL),
  (23, 'WB', 'CAR', 'MRVL', NULL),
  (24, 'ADL', 'GWS', 'AO', NULL),
  (24, 'COL', 'BRL', 'MCG', NULL),
  (24, 'CAR', 'FRE', 'MRVL', NULL),
  (24, 'ESS', 'PA', 'MRVL', NULL),
  (24, 'GEE', 'RIC', 'GMHBA', NULL),
  (24, 'MEL', 'WB', 'MCG', NULL),
  (24, 'STK', 'GC', 'MRVL', NULL),
  (24, 'SYD', 'NM', 'SCG', NULL),
  (24, 'WC', 'HAW', 'OS', NULL);

-- Insert into matches table with team ID lookups and expanded venue names
INSERT INTO matches (round, season, venue, match_date, home_score, away_score, winner, is_complete, home_team_id, away_team_id)
SELECT
  t.round,
  2026,
  CASE t.venue
    WHEN 'AO' THEN 'Adelaide Oval'
    WHEN 'BP' THEN 'Barossa Park'
    WHEN 'CGOM' THEN 'Manuka Oval'
    WHEN 'ES' THEN 'ENGIE Stadium'
    WHEN 'G' THEN 'The Gabba'
    WHEN 'GMHBA' THEN 'GMHBA Stadium'
    WHEN 'HO' THEN 'Hands Oval'
    WHEN 'MRVL' THEN 'Marvel Stadium'
    WHEN 'PFS' THEN 'People First Stadium'
    WHEN 'NS' THEN 'Ninja Stadium'
    WHEN 'NO' THEN 'Norwood Oval'
    WHEN 'OS' THEN 'Optus Stadium'
    WHEN 'TIO' THEN 'TIO Stadium'
    WHEN 'TP' THEN 'TIO Traeger Park'
    WHEN 'UTAS' THEN 'UTAS Stadium'
    ELSE t.venue
  END,
  t.match_date,
  NULL,
  NULL,
  NULL,
  FALSE,
  ht.id,
  at.id
FROM tmp_2026_fixture t
JOIN teams ht ON ht.abbreviation = t.home_abbr
JOIN teams at ON at.abbreviation = t.away_abbr;

-- Clean up temp table
DROP TABLE tmp_2026_fixture;
